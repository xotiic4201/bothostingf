<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Discord Bot Hosting Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #7289da;
            --secondary-color: #424549;
            --dark-color: #36393f;
            --success-color: #43b581;
            --danger-color: #f04747;
            --warning-color: #faa61a;
        }
        
        body {
            background-color: #36393f;
            color: #ffffff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background-color: var(--secondary-color) !important;
        }
        
        .bot-card {
            background-color: var(--secondary-color);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        
        .bot-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        .status-running { color: var(--success-color); }
        .status-stopped { color: var(--danger-color); }
        .status-starting { color: var(--warning-color); }
        .status-error { color: var(--danger-color); }
        
        .progress {
            height: 8px;
            margin-top: 5px;
        }
        
        .log-container {
            background-color: #2f3136;
            border-radius: 5px;
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .upload-area {
            border: 2px dashed var(--primary-color);
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .upload-area:hover {
            background-color: rgba(114, 137, 218, 0.1);
        }
        
        .stats-card {
            background: linear-gradient(135deg, var(--primary-color), #5b6eae);
            border-radius: 10px;
            padding: 20px;
            color: white;
        }
        
        .bot-actions .btn {
            margin: 2px;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="bi bi-robot"></i> Discord Bot Host
            </a>
            <div class="d-flex">
                <span class="navbar-text me-3" id="connection-status">
                    <i class="bi bi-circle-fill text-danger"></i> Disconnected
                </span>
                <button class="btn btn-outline-light" onclick="showUploadModal()">
                    <i class="bi bi-plus-circle"></i> New Bot
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container-fluid mt-4">
        <!-- Stats Row -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="stats-card">
                    <h5><i class="bi bi-robot"></i> Total Bots</h5>
                    <h2 id="total-bots">0</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <h5><i class="bi bi-play-circle"></i> Running</h5>
                    <h2 id="running-bots">0</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <h5><i class="bi bi-cpu"></i> CPU Usage</h5>
                    <h2 id="total-cpu">0%</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <h5><i class="bi bi-memory"></i> Memory</h5>
                    <h2 id="total-memory">0 MB</h2>
                </div>
            </div>
        </div>

        <!-- Bots Grid -->
        <div class="row" id="bots-container">
            <!-- Bots will be dynamically added here -->
        </div>

        <!-- Empty State -->
        <div class="text-center py-5" id="empty-state">
            <i class="bi bi-robot" style="font-size: 4rem; opacity: 0.3;"></i>
            <h3 class="mt-3">No Bots Running</h3>
            <p class="text-muted">Upload your first Discord bot to get started</p>
            <button class="btn btn-primary btn-lg" onclick="showUploadModal()">
                <i class="bi bi-plus-circle"></i> Deploy Your First Bot
            </button>
        </div>
    </div>

    <!-- Upload Modal -->
    <div class="modal fade" id="uploadModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header">
                    <h5 class="modal-title">Deploy New Bot</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="upload-area" onclick="document.getElementById('botFile').click()" id="dropArea">
                        <i class="bi bi-cloud-arrow-up" style="font-size: 3rem;"></i>
                        <h5>Drop bot files here or click to upload</h5>
                        <p class="text-muted">Supports .py, .js, .zip files</p>
                        <input type="file" id="botFile" hidden accept=".py,.js,.zip,.json">
                    </div>
                    
                    <div class="mt-4">
                        <h6>Bot Configuration</h6>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Bot Name</label>
                                <input type="text" class="form-control bg-secondary border-dark text-light" id="botName" placeholder="My Awesome Bot">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Bot Type</label>
                                <select class="form-select bg-secondary border-dark text-light" id="botType">
                                    <option value="python">Python (discord.py)</option>
                                    <option value="nodejs">Node.js (discord.js)</option>
                                </select>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label">Discord Bot Token</label>
                                <div class="input-group">
                                    <input type="password" class="form-control bg-secondary border-dark text-light" id="botToken" placeholder="Enter your bot token">
                                    <button class="btn btn-outline-secondary" type="button" onclick="toggleTokenVisibility()">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                </div>
                                <small class="text-muted">Your token is stored locally and never sent to our servers</small>
                            </div>
                            <div class="col-md-12">
                                <label class="form-label">Bot Code (Optional if uploading file)</label>
                                <textarea class="form-control bg-secondary border-dark text-light" id="botCode" rows="10" placeholder="# Your bot code here..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="deployBot()" id="deployBtn">
                        <i class="bi bi-cloud-upload"></i> Deploy Bot
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bot Details Modal -->
    <div class="modal fade" id="botDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header">
                    <h5 class="modal-title" id="detailsBotName">Bot Details</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Status Information</h6>
                            <table class="table table-dark">
                                <tr>
                                    <td>Status:</td>
                                    <td><span id="detailsStatus">Unknown</span></td>
                                </tr>
                                <tr>
                                    <td>Uptime:</td>
                                    <td id="detailsUptime">0</td>
                                </tr>
                                <tr>
                                    <td>CPU Usage:</td>
                                    <td id="detailsCpu">0%</td>
                                </tr>
                                <tr>
                                    <td>Memory Usage:</td>
                                    <td id="detailsMemory">0 MB</td>
                                </tr>
                                <tr>
                                    <td>Type:</td>
                                    <td id="detailsType">Unknown</td>
                                </tr>
                                <tr>
                                    <td>Bot ID:</td>
                                    <td><code id="detailsBotId">N/A</code></td>
                                </tr>
                            </table>
                            
                            <div class="mt-3">
                                <h6>Quick Actions</h6>
                                <div class="d-flex flex-wrap gap-2" id="detailsActions">
                                    <!-- Actions will be added here -->
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>Live Logs</h6>
                            <div class="log-container" id="detailsLogs">
                                <!-- Logs will be added here -->
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-sm btn-outline-secondary" onclick="clearLogs()">
                                    <i class="bi bi-trash"></i> Clear Logs
                                </button>
                                <button class="btn btn-sm btn-outline-secondary" onclick="downloadLogs()">
                                    <i class="bi bi-download"></i> Download Logs
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <script>
        // Configuration
        const SERVER_URL = 'https://bot-hosting-b.onrender.com'; // Change this to your Render URL
        const API_URL = `${SERVER_URL}/api`;
        
        // Global variables
        let socket = null;
        let bots = {};
        let currentBotDetails = null;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            connectWebSocket();
            loadBots();
            setupDragAndDrop();
            
            // Refresh stats every 10 seconds
            setInterval(loadSystemStats, 10000);
        });
        
        // WebSocket Connection
        function connectWebSocket() {
            socket = io(SERVER_URL);
            
            socket.on('connect', () => {
                updateConnectionStatus(true);
                console.log('Connected to server');
            });
            
            socket.on('disconnect', () => {
                updateConnectionStatus(false);
                console.log('Disconnected from server');
            });
            
            socket.on('bot_update', (data) => {
                updateBot(data.bot);
            });
            
            socket.on('bot_deployed', (data) => {
                alert(`Bot deployed successfully! ID: ${data.bot_id}`);
                $('#uploadModal').modal('hide');
            });
        }
        
        // Update connection status display
        function updateConnectionStatus(connected) {
            const statusEl = document.getElementById('connection-status');
            if (connected) {
                statusEl.innerHTML = '<i class="bi bi-circle-fill text-success"></i> Connected';
            } else {
                statusEl.innerHTML = '<i class="bi bi-circle-fill text-danger"></i> Disconnected';
            }
        }
        
        // Load bots from API
        async function loadBots() {
            try {
                const response = await fetch(`${API_URL}/bots`);
                const data = await response.json();
                
                bots = {};
                data.bots.forEach(bot => {
                    bots[bot.id] = bot;
                });
                
                renderBots();
                updateStats();
            } catch (error) {
                console.error('Error loading bots:', error);
            }
        }
        
        // Load system stats
        async function loadSystemStats() {
            try {
                const response = await fetch(`${API_URL}/system/stats`);
                const data = await response.json();
                
                document.getElementById('total-bots').textContent = data.total_bots;
                document.getElementById('running-bots').textContent = data.running_bots;
                
                // Calculate total CPU and Memory
                let totalCpu = 0;
                let totalMemory = 0;
                
                Object.values(bots).forEach(bot => {
                    totalCpu += bot.cpu || 0;
                    totalMemory += bot.memory || 0;
                });
                
                document.getElementById('total-cpu').textContent = `${totalCpu.toFixed(1)}%`;
                document.getElementById('total-memory').textContent = `${totalMemory.toFixed(1)} MB`;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        
        // Update bot in display
        function updateBot(bot) {
            bots[bot.id] = bot;
            
            // Update card if exists
            const card = document.getElementById(`bot-card-${bot.id}`);
            if (card) {
                updateBotCard(card, bot);
            } else {
                // Add new card
                renderBots();
            }
            
            // Update details modal if open
            if (currentBotDetails === bot.id) {
                updateBotDetails(bot);
            }
            
            updateStats();
        }
        
        // Render all bots
        function renderBots() {
            const container = document.getElementById('bots-container');
            const emptyState = document.getElementById('empty-state');
            
            if (Object.keys(bots).length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            container.innerHTML = '';
            
            Object.values(bots).forEach(bot => {
                const botCard = createBotCard(bot);
                container.appendChild(botCard);
            });
        }
        
        // Create bot card HTML
        function createBotCard(bot) {
            const div = document.createElement('div');
            div.className = 'col-md-6 col-lg-4';
            div.id = `bot-card-${bot.id}`;
            
            const statusClass = `status-${bot.status}`;
            const statusIcon = getStatusIcon(bot.status);
            
            div.innerHTML = `
                <div class="bot-card">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h5 class="mb-0">
                            <i class="bi bi-robot"></i> ${bot.name}
                        </h5>
                        <span class="badge ${statusClass}">
                            <i class="bi ${statusIcon}"></i> ${bot.status}
                        </span>
                    </div>
                    
                    <div class="mb-3">
                        <small class="text-muted">ID: ${bot.id.substring(0, 8)}...</small>
                    </div>
                    
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <small>CPU: ${bot.cpu || 0}%</small>
                            <small>RAM: ${(bot.memory || 0).toFixed(1)} MB</small>
                        </div>
                        <div class="progress bg-secondary">
                            <div class="progress-bar" style="width: ${Math.min(bot.cpu || 0, 100)}%"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <small>Uptime: ${bot.uptime || '0'}</small>
                    </div>
                    
                    <div class="bot-actions">
                        <button class="btn btn-sm btn-success" onclick="startBot('${bot.id}')" ${bot.status === 'running' ? 'disabled' : ''}>
                            <i class="bi bi-play"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="stopBot('${bot.id}')" ${bot.status !== 'running' ? 'disabled' : ''}>
                            <i class="bi bi-stop"></i>
                        </button>
                        <button class="btn btn-sm btn-warning" onclick="restartBot('${bot.id}')">
                            <i class="bi bi-arrow-clockwise"></i>
                        </button>
                        <button class="btn btn-sm btn-info" onclick="showBotDetails('${bot.id}')">
                            <i class="bi bi-info-circle"></i>
                        </button>
                    </div>
                </div>
            `;
            
            return div;
        }
        
        // Update bot card
        function updateBotCard(card, bot) {
            const statusClass = `status-${bot.status}`;
            const statusIcon = getStatusIcon(bot.status);
            
            card.querySelector('.badge').className = `badge ${statusClass}`;
            card.querySelector('.badge').innerHTML = `<i class="bi ${statusIcon}"></i> ${bot.status}`;
            
            card.querySelector('.progress-bar').style.width = `${Math.min(bot.cpu || 0, 100)}%`;
            card.querySelectorAll('small')[1].innerHTML = `CPU: ${bot.cpu || 0}%`;
            card.querySelectorAll('small')[2].innerHTML = `RAM: ${(bot.memory || 0).toFixed(1)} MB`;
            card.querySelectorAll('small')[3].innerHTML = `Uptime: ${bot.uptime || '0'}`;
            
            // Update button states
            const startBtn = card.querySelector('.btn-success');
            const stopBtn = card.querySelector('.btn-danger');
            
            if (bot.status === 'running') {
                startBtn.disabled = true;
                stopBtn.disabled = false;
            } else {
                startBtn.disabled = false;
                stopBtn.disabled = true;
            }
        }
        
        // Get status icon
        function getStatusIcon(status) {
            switch(status) {
                case 'running': return 'bi-play-circle';
                case 'stopped': return 'bi-stop-circle';
                case 'starting': return 'bi-hourglass';
                case 'error': return 'bi-exclamation-circle';
                default: return 'bi-question-circle';
            }
        }
        
        // Bot control functions
        function startBot(botId) {
            socket.emit('start_bot', { bot_id: botId });
        }
        
        function stopBot(botId) {
            socket.emit('stop_bot', { bot_id: botId });
        }
        
        function restartBot(botId) {
            socket.emit('restart_bot', { bot_id: botId });
        }
        
        // Show bot details
        function showBotDetails(botId) {
            const bot = bots[botId];
            if (!bot) return;
            
            currentBotDetails = botId;
            
            document.getElementById('detailsBotName').textContent = bot.name;
            document.getElementById('detailsStatus').textContent = bot.status;
            document.getElementById('detailsStatus').className = `status-${bot.status}`;
            document.getElementById('detailsUptime').textContent = bot.uptime || '0';
            document.getElementById('detailsCpu').textContent = `${bot.cpu || 0}%`;
            document.getElementById('detailsMemory').textContent = `${(bot.memory || 0).toFixed(1)} MB`;
            document.getElementById('detailsType').textContent = bot.type || 'Unknown';
            document.getElementById('detailsBotId').textContent = bot.id;
            
            // Update logs
            const logsContainer = document.getElementById('detailsLogs');
            logsContainer.innerHTML = '';
            
            if (bot.logs && bot.logs.length > 0) {
                bot.logs.slice(-50).forEach(log => {
                    const logLine = document.createElement('div');
                    logLine.textContent = typeof log === 'string' ? log : JSON.stringify(log);
                    logLine.className = 'log-line';
                    logsContainer.appendChild(logLine);
                });
                logsContainer.scrollTop = logsContainer.scrollHeight;
            }
            
            // Update actions
            const actionsContainer = document.getElementById('detailsActions');
            actionsContainer.innerHTML = '';
            
            const actions = [
                { label: 'Start', class: 'success', onClick: `startBot('${botId}')`, disabled: bot.status === 'running' },
                { label: 'Stop', class: 'danger', onClick: `stopBot('${botId}')`, disabled: bot.status !== 'running' },
                { label: 'Restart', class: 'warning', onClick: `restartBot('${botId}')` },
                { label: 'View Logs', class: 'info', onClick: `loadBotLogs('${botId}')` }
            ];
            
            actions.forEach(action => {
                const btn = document.createElement('button');
                btn.className = `btn btn-${action.class}`;
                btn.textContent = action.label;
                btn.onclick = new Function(action.onClick);
                if (action.disabled) btn.disabled = true;
                actionsContainer.appendChild(btn);
            });
            
            $('#botDetailsModal').modal('show');
        }
        
        // Update bot details
        function updateBotDetails(bot) {
            if (currentBotDetails !== bot.id) return;
            
            document.getElementById('detailsStatus').textContent = bot.status;
            document.getElementById('detailsStatus').className = `status-${bot.status}`;
            document.getElementById('detailsUptime').textContent = bot.uptime || '0';
            document.getElementById('detailsCpu').textContent = `${bot.cpu || 0}%`;
            document.getElementById('detailsMemory').textContent = `${(bot.memory || 0).toFixed(1)} MB`;
            
            // Update logs
            const logsContainer = document.getElementById('detailsLogs');
            if (bot.logs && bot.logs.length > 0) {
                const lastLog = bot.logs[bot.logs.length - 1];
                const logLine = document.createElement('div');
                logLine.textContent = typeof lastLog === 'string' ? lastLog : JSON.stringify(lastLog);
                logLine.className = 'log-line';
                logsContainer.appendChild(logLine);
                
                // Keep only last 50 lines
                while (logsContainer.children.length > 50) {
                    logsContainer.removeChild(logsContainer.firstChild);
                }
                
                logsContainer.scrollTop = logsContainer.scrollHeight;
            }
        }
        
        // Load bot logs
        async function loadBotLogs(botId) {
            try {
                const response = await fetch(`${API_URL}/bot/${botId}/logs`);
                const data = await response.json();
                
                const logsContainer = document.getElementById('detailsLogs');
                logsContainer.innerHTML = '';
                
                data.logs.forEach(log => {
                    const logLine = document.createElement('div');
                    logLine.textContent = typeof log === 'string' ? log : JSON.stringify(log);
                    logLine.className = 'log-line';
                    logsContainer.appendChild(logLine);
                });
                
                logsContainer.scrollTop = logsContainer.scrollHeight;
            } catch (error) {
                console.error('Error loading logs:', error);
            }
        }
        
        // Clear logs
        function clearLogs() {
            const logsContainer = document.getElementById('detailsLogs');
            logsContainer.innerHTML = '';
        }
        
        // Download logs
        function downloadLogs() {
            const logsContainer = document.getElementById('detailsLogs');
            const logs = Array.from(logsContainer.children).map(line => line.textContent).join('\n');
            
            const blob = new Blob([logs], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `bot-logs-${currentBotDetails}-${new Date().toISOString()}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Upload modal
        function showUploadModal() {
            document.getElementById('botName').value = '';
            document.getElementById('botToken').value = '';
            document.getElementById('botCode').value = '';
            document.getElementById('botType').value = 'python';
            $('#uploadModal').modal('show');
        }
        
        // Toggle token visibility
        function toggleTokenVisibility() {
            const tokenInput = document.getElementById('botToken');
            const toggleBtn = event.currentTarget;
            
            if (tokenInput.type === 'password') {
                tokenInput.type = 'text';
                toggleBtn.innerHTML = '<i class="bi bi-eye-slash"></i>';
            } else {
                tokenInput.type = 'password';
                toggleBtn.innerHTML = '<i class="bi bi-eye"></i>';
            }
        }
        
        // Setup drag and drop
        function setupDragAndDrop() {
            const dropArea = document.getElementById('dropArea');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropArea.style.backgroundColor = 'rgba(114, 137, 218, 0.2)';
            }
            
            function unhighlight() {
                dropArea.style.backgroundColor = '';
            }
            
            dropArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    handleFiles(files);
                }
            }
            
            // File input change
            document.getElementById('botFile').addEventListener('change', function(e) {
                handleFiles(e.target.files);
            });
        }
        
        // Handle uploaded files
        function handleFiles(files) {
            const file = files[0];
            if (!file) return;
            
            // Update bot name with filename
            const botName = document.getElementById('botName');
            if (!botName.value) {
                botName.value = file.name.replace(/\.[^/.]+$/, "");
            }
            
            // Read file content if it's a text file
            if (file.type === 'text/plain' || file.name.endsWith('.py') || file.name.endsWith('.js')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('botCode').value = e.target.result;
                };
                reader.readAsText(file);
            }
            
            // Show file info
            const dropArea = document.getElementById('dropArea');
            dropArea.innerHTML = `
                <i class="bi bi-file-earmark-code" style="font-size: 3rem;"></i>
                <h5>${file.name}</h5>
                <p class="text-muted">${(file.size / 1024).toFixed(2)} KB â€¢ Ready to deploy</p>
            `;
        }
        
        // Deploy bot
        async function deployBot() {
            const botName = document.getElementById('botName').value;
            const botType = document.getElementById('botType').value;
            const botToken = document.getElementById('botToken').value;
            const botCode = document.getElementById('botCode').value;
            const botFile = document.getElementById('botFile').files[0];
            
            if (!botName) {
                alert('Please enter a bot name');
                return;
            }
            
            if (!botToken) {
                alert('Please enter a bot token');
                return;
            }
            
            const deployBtn = document.getElementById('deployBtn');
            deployBtn.disabled = true;
            deployBtn.innerHTML = '<i class="bi bi-hourglass"></i> Deploying...';
            
            try {
                // Prepare bot data
                const botData = {
                    name: botName,
                    type: botType,
                    token: botToken,
                    code: botCode
                };
                
                // If file uploaded, send it
                if (botFile) {
                    const formData = new FormData();
                    formData.append('file', botFile);
                    formData.append('name', botName);
                    formData.append('token', botToken);
                    
                    const response = await fetch(`${API_URL}/upload`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!response.ok) {
                        throw new Error('Upload failed');
                    }
                } else {
                    // Send via WebSocket
                    socket.emit('deploy_bot', botData);
                }
                
            } catch (error) {
                console.error('Deployment error:', error);
                alert('Error deploying bot: ' + error.message);
                deployBtn.disabled = false;
                deployBtn.innerHTML = '<i class="bi bi-cloud-upload"></i> Deploy Bot';
            }
        }
        
        // Update stats
        function updateStats() {
            const total = Object.keys(bots).length;
            const running = Object.values(bots).filter(b => b.status === 'running').length;
            
            document.getElementById('total-bots').textContent = total;
            document.getElementById('running-bots').textContent = running;
            
            // Update empty state
            const emptyState = document.getElementById('empty-state');
            emptyState.style.display = total === 0 ? 'block' : 'none';
        }
    </script>
</body>

</html>
